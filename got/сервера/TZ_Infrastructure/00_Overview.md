# UNDE Infrastructure â€” Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ğµ Ğ¢Ğ— v6.1

## ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

- **1 ÑĞµÑ€Ğ²ĞµÑ€ = 1 Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°** â€” Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ¸ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- **Staging â†’ Production** â€” ÑÑ‹Ñ€Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ² prod Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
- **Ğ¤Ğ¾Ñ‚Ğ¾ Ñƒ Ğ½Ğ°Ñ** â€” Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼ Ğ¾Ñ‚ CDN Ğ±Ñ€ĞµĞ½Ğ´Ğ¾Ğ², Zara Ğ½Ğ°Ñ Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ¸Ñ‚
- **Dubai primary, Hetzner replicas** â€” primary DB Ğ² Ğ”ÑƒĞ±Ğ°Ğµ (bare metal, tmpfs), Hetzner Helsinki â€” hot standby replicas + Ğ±ÑĞºĞ°Ğ¿Ñ‹
- **RAM â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ bottleneck** â€” CPU, Ğ´Ğ¸ÑĞº, ÑĞµÑ‚ÑŒ â€” Ğ²ÑÑ‘ Ñ Ğ·Ğ°Ğ¿Ğ°ÑĞ¾Ğ¼ 50â€“100Ã—. ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ = Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ RAM Ñ‡ĞµÑ€ĞµĞ· Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑˆĞ°Ñ€Ğ´Ñ‹
- **Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° tmpfs, WAL Ğ½Ğ° NVMe** â€” Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ (Ğ½Ğ°Ğ½Ğ¾ÑĞµĞºÑƒĞ½Ğ´Ñ‹), durability Ñ‡ĞµÑ€ĞµĞ· WAL Ğ¸ streaming replication
- **Chat History + User Knowledge = Ğ¾Ğ´Ğ¸Ğ½ ÑˆĞ°Ñ€Ğ´** â€” Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ·ĞµÑ€Ğ° Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€Ğµ, Ğ¾Ğ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ ContextPack
- **Ğ¢Ñ€Ğ¸ ÑĞ»Ğ¾Ñ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ + Epistemic Contract** â€” User Knowledge (Ñ„Ğ°ĞºÑ‚Ñ‹, ĞºĞµÑˆ Ñ evidence pointers) + Semantic Retrieval (ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹ Ğ¸Ğ· Ñ‡Ğ°Ñ‚Ğ°, pgvector, raw_excerpt head+tail) + Context Agent (Ğ¼Ğ¸Ñ€ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ ÑĞ·ĞµÑ€Ğ°). [Epistemic Contract](../UNDE_Knowledge_Staging_Pipeline.md): RAW â€” ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ¿Ñ€Ğ°Ğ²Ğ´Ñ‹; User Knowledge â€” ĞºĞµÑˆ, Ğ½Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ; Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ¶Ğ´Ğ°ĞµÑ‚ÑÑ raw excerpt + message_ids. [Knowledge Staging Pipeline](../UNDE_Knowledge_Staging_Pipeline.md) â€” Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ pipeline Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹
- **Application-level sharding** â€” Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ hash(user_id) % N Ğ² Redis. ĞĞ¸ĞºĞ°ĞºĞ¾Ğ¹ Ğ¼Ğ°Ğ³Ğ¸Ğ¸ distributed SQL
- **Client-side verify-and-replay** â€” Ğ½ÑƒĞ»ĞµĞ²Ğ°Ñ Ğ¿Ğ¾Ñ‚ĞµÑ€Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ failover. ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ±ÑƒÑ„ĞµÑ€ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¿Ğ°Ñ€ Ğ¸ Ğ¿ĞµÑ€ĞµĞ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¸ reconnect
- **Failover auto, failback manual** â€” Patroni Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ½Ğ° Hetzner Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ½Ğ° Dubai â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
- **Ğ¢Ñ€Ğ¸ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° â€” ÑĞµĞ½ÑĞ¾Ñ€Ñ‹ Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ñ‚Ğ¾Ñ€** â€” Mood Agent (ĞºĞ°Ğº ÑĞ·ĞµÑ€ ÑĞµĞ±Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚) + Context Agent (Ñ‡Ñ‚Ğ¾ Ğ²Ğ¾ĞºÑ€ÑƒĞ³) = ÑĞµĞ½ÑĞ¾Ñ€Ñ‹ â†’ Persona Agent (ĞºĞ°Ğº Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€ Ğ²ĞµĞ´Ñ‘Ñ‚ ÑĞµĞ±Ñ) = Ğ°ĞºÑ‚ÑƒĞ°Ñ‚Ğ¾Ñ€. persona_directive â†’ LLM, voice_params â†’ ElevenLabs, avatar_state â†’ Rive, render_hints â†’ App

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

```
                                        INTERNET
                                            â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                   â”‚                   â”‚
                        â–¼                   â–¼                   â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Apify.com   â”‚    â”‚ Zara Mobile  â”‚    â”‚   fal.ai     â”‚
                â”‚  (scrapers)  â”‚    â”‚     API      â”‚    â”‚  (try-on)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                   â”‚                   â–²
                       â”‚ Ğ ĞµĞ·Ğ¸Ğ´ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ       â”‚ 4 req/Ñ‡Ğ°Ñ         â”‚
                       â”‚ Ğ¿Ñ€Ğ¾ĞºÑĞ¸            â”‚ (Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ)         â”‚
                       â–¼                   â–¼                   â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
              â”‚ APIFY SERVER    â”‚ â”‚ SCRAPER SERVER  â”‚          â”‚
              â”‚ (10.1.0.7)      â”‚ â”‚ (10.1.0.3)      â”‚          â”‚
              â”‚ Hetzner Helsinkiâ”‚ â”‚ Hetzner Helsinkiâ”‚          â”‚
              â”‚                 â”‚ â”‚                 â”‚          â”‚
              â”‚ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:         â”‚ â”‚ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:         â”‚          â”‚
              â”‚ â€¢ ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ    â”‚ â”‚ â€¢ Mobile API    â”‚          â”‚
              â”‚   ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°      â”‚ â”‚   (Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ)     â”‚          â”‚
              â”‚                 â”‚ â”‚ â€¢ Sync job      â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                       â”‚                   â”‚                   â”‚
                       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                       â”‚    â”‚                                  â”‚
                       â–¼    â–¼                                  â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
              â”‚  STAGING DB (10.1.1.3)               â”‚         â”‚
              â”‚  Hetzner Helsinki                    â”‚         â”‚
              â”‚  PostgreSQL 17                       â”‚         â”‚
              â”‚  â”œâ”€â”€ raw_products (Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)       â”‚         â”‚
              â”‚  â”œâ”€â”€ raw_availability (Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ)      â”‚         â”‚
              â”‚  â””â”€â”€ scraper_logs                    â”‚         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                â”‚                              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
     â”‚              â”‚           â”‚                    â”‚         â”‚
     â–¼              â–¼           â”‚                    â–¼         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PHOTO       â”‚ â”‚XIMILAR     â”‚  â”‚         â”‚  COLLAGE SERVER (10.1.0.8)  â”‚
â”‚DOWNLOADER  â”‚ â”‚SYNC        â”‚  â”‚         â”‚  Hetzner Helsinki           â”‚
â”‚(10.1.0.13) â”‚ â”‚(10.1.0.14) â”‚  â”‚         â”‚                             â”‚
â”‚ â€¢ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ  â”‚ â”‚ â€¢ SKU â†’    â”‚  â”‚         â”‚  Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸:                    â”‚
â”‚   Ñ„Ğ¾Ñ‚Ğ¾     â”‚ â”‚   Ximilar  â”‚  â”‚         â”‚  â€¢ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸Ğ· /originals/   â”‚
â”‚ â€¢ Upload   â”‚ â”‚   Collectionâ”‚  â”‚         â”‚  â€¢ Ğ¡ĞºĞ»ĞµĞ¸Ñ‚ÑŒ Ğ² ĞºĞ¾Ğ»Ğ»Ğ°Ğ¶         â”‚
â”‚   Ğ² OS     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚  â€¢ Upload Ğ² /collages/      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚
       â–¼                       â”‚ SYNC JOB (hourly)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â–¼
â”‚  OBJECT STORAGE     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  (Hetzner Helsinki) â”‚ â”‚  PRODUCTION DB (10.1.1.2)            â”‚
â”‚                     â”‚ â”‚  Hetzner Helsinki                    â”‚
â”‚  Bucket: unde-imagesâ”‚ â”‚  PostgreSQL 17 + PgBouncer           â”‚
â”‚  â”œâ”€â”€ /originals/    â”‚ â”‚  â””â”€â”€ products                        â”‚
â”‚  â””â”€â”€ /collages/     â”‚ â”‚      â”œâ”€â”€ sku, name, price, brand     â”‚
â”‚                     â”‚ â”‚      â”œâ”€â”€ image_url (â†’ /originals/)   â”‚
â”‚  Bucket: user-media â”‚ â”‚      â”œâ”€â”€ collage_url (â†’ /collages/)  â”‚
â”‚  â””â”€â”€ /{user_id}/    â”‚ â”‚      â””â”€â”€ availability (JSONB)        â”‚
â”‚                     â”‚ â”‚  â””â”€â”€ routing_table (user â†’ shard)    â”‚
â”‚  Bucket: backups    â”‚ â”‚  â””â”€â”€ deleted_messages_registry       â”‚
â”‚  â””â”€â”€ /shard-N/      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                     â”‚                      â”‚
                     â–¼                     â–¼                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ APP SERVER   â”‚  â”‚ TRY-ON SERVICEâ”‚  â”‚ RECOGNITION       â”‚
              â”‚ (10.1.0.2)   â”‚  â”‚ (10.1.0.6)    â”‚  â”‚ ORCHESTRATOR      â”‚
              â”‚ Hetzner      â”‚  â”‚ â€¢ collageâ†’fal â”‚  â”‚ (10.1.0.9)        â”‚
              â”‚ â””â”€â”€ API      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚          â”‚
                     â”‚                                 â–¼          â–¼
                     â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                     â”‚XIMILAR GW  â”‚ â”‚LLM RERANKERâ”‚
                     â”‚                     â”‚(10.1.0.15) â”‚ â”‚(10.1.0.16) â”‚
                     â”‚                     â”‚â€¢ detect    â”‚ â”‚â€¢ Gemini tagâ”‚
                     â”‚                     â”‚â€¢ tag       â”‚ â”‚â€¢ Gemini    â”‚
                     â”‚                     â”‚â€¢ search    â”‚ â”‚  rerank    â”‚
                     â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ LLM ORCHESTRATOR (10.1.0.17)      â”‚
                     â”‚  â”‚ Hetzner Helsinki                  â”‚
                     â”‚  â”‚ â€¢ ContextPack (3 ÑĞ»Ğ¾Ñ Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ)     â”‚
                     â”‚  â”‚   â†’ User Knowledge + Semantic     â”‚
                     â”‚  â”‚     Retrieval + Context Agent      â”‚
                     â”‚  â”‚ â€¢ Embedding client (Cohere)       â”‚
                     â”‚  â”‚ â€¢ â†’ DeepSeek/Gemini/Claude/Qwen   â”‚
                     â”‚  â”‚ â€¢ â†’ Voice Server (Ñ‚ĞµĞºÑÑ‚â†’TTS)      â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ MOOD AGENT    â”‚  â”‚ PERSONA AGENT â”‚  â”‚ VOICE SERVER  â”‚
                     â”‚  â”‚ (10.1.0.11)   â”‚  â”‚ (10.1.0.21)   â”‚  â”‚ (10.1.0.12)   â”‚
                     â”‚  â”‚ â€¢ Ğ­Ğ¼Ğ¾Ñ†. Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·â”‚  â”‚ â€¢ Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€    â”‚  â”‚ â€¢ ElevenLabs  â”‚
                     â”‚  â”‚ â€¢ mood_frame  â”‚â†’ â”‚ â€¢ persona_dir â”‚â†’ â”‚ â€¢ TTS stream  â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ voice_paramsâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                     â”‚ â€¢ avatar_stateâ”‚
                     â”‚                     â”‚ â€¢ render_hintsâ”‚
                     â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ CONTEXT AGENT (10.1.0.19)         â”‚
                     â”‚  â”‚ Hetzner Helsinki                  â”‚
                     â”‚  â”‚ â€¢ Ğ“ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ, Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ°, Ğ²Ñ€ĞµĞ¼Ñ       â”‚
                     â”‚  â”‚ â€¢ ĞšÑƒĞ»ÑŒÑ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ (Ğ Ğ°Ğ¼Ğ°Ğ´Ğ°Ğ½)   â”‚
                     â”‚  â”‚ â€¢ Events + Opportunities          â”‚
                     â”‚  â”‚ â€¢ â†’ context_frame JSON            â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ USER DATA LAYER (ÑˆĞ°Ñ€Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹)                 â”‚
                     â”‚  â”‚                                                 â”‚
                     â”‚  â”‚ DUBAI PRIMARY SHARD (bare metal, 256 GB RAM)    â”‚
                     â”‚  â”‚ â”œâ”€â”€ pgdata Ğ½Ğ° tmpfs (RAM) â€” sub-Î¼s reads       â”‚
                     â”‚  â”‚ â”œâ”€â”€ WAL Ğ½Ğ° NVMe (synchronous_commit=local)     â”‚
                     â”‚  â”‚ â”œâ”€â”€ Chat History (pgvector, FTS, Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ†Ğ¸Ğ¸)     â”‚
                     â”‚  â”‚ â”œâ”€â”€ User Knowledge (AES-256)                   â”‚
                     â”‚  â”‚ â””â”€â”€ Patroni primary                            â”‚
                     â”‚  â”‚       â”‚                                         â”‚
                     â”‚  â”‚       â”‚ async WAL streaming (120ms)             â”‚
                     â”‚  â”‚       â–¼                                         â”‚
                     â”‚  â”‚ HETZNER REPLICA (AX102, 128 GB RAM)            â”‚
                     â”‚  â”‚ â”œâ”€â”€ Hot standby (NVMe, fsync)                  â”‚
                     â”‚  â”‚ â”œâ”€â”€ Patroni + etcd â†’ auto failover             â”‚
                     â”‚  â”‚ â””â”€â”€ pg_basebackup â†’ Object Storage             â”‚
                     â”‚  â”‚                                                 â”‚
                     â”‚  â”‚ Bucket: unde-user-media ğŸ”’                     â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ ğŸ“± ĞŸĞ Ğ˜Ğ›ĞĞ–Ğ•ĞĞ˜Ğ•â”‚
              â”‚ ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³      â”‚
              â”‚ Try-on       â”‚
              â”‚ Recognition  â”‚
              â”‚ Voice + Mood â”‚
              â”‚ Context      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞšĞ°Ñ€Ñ‚Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²

### Hetzner Helsinki (Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³, scraping, ML-pipeline)

| Ğ¡ĞµÑ€Ğ²ĞµÑ€ | IP (private) | IP (public) | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¢Ğ¸Ğ¿ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|--------|-------------|-------------|--------|-----|--------|
| unde-app | 10.1.0.2 | 46.62.233.30 | API, Nginx, Prometheus | CX43 (160GB) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| scraper | 10.1.0.3 | 46.62.255.184 | Mobile API (Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ) + Sync | CPX22 (80GB) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| push | 10.1.0.4 | 77.42.30.44 | Redis, Celery broker | CPX32 (160GB) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| model-generator | 10.1.0.5 | 89.167.20.60 | AI-Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ñ‹) | CPX22 (80GB) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| tryon-service | 10.1.0.6 | 89.167.31.65 | Virtual try-on | CPX22 (80GB) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| **apify** | **10.1.0.7** | â€” | **Ğ¡Ğ±Ğ¾Ñ€ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° (Apify.com)** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **collage** | **10.1.0.8** | â€” | **Ğ¡ĞºĞ»ĞµĞ¹ĞºĞ° Ñ„Ğ¾Ñ‚Ğ¾** | **CPX31 (160GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **recognition** | **10.1.0.9** | â€” | **Recognition Orchestrator (ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ pipeline)** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **mood-agent** | **10.1.0.11** | â€” | **Mood Agent (ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·)** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **voice** | **10.1.0.12** | â€” | **Voice TTS (ElevenLabs proxy)** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **photo-downloader** | **10.1.0.13** | â€” | **Ğ¡ĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ¾Ñ‚Ğ¾ Ğ±Ñ€ĞµĞ½Ğ´Ğ¾Ğ² â†’ Object Storage** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **ximilar-sync** | **10.1.0.14** | â€” | **Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° â†’ Ximilar Collection** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **ximilar-gw** | **10.1.0.15** | â€” | **Ximilar Gateway (detect, tag, search)** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **llm-reranker** | **10.1.0.16** | â€” | **LLM Reranker (Gemini tag + rerank)** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **llm-orchestrator** | **10.1.0.17** | â€” | **Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ LLM Orchestrator (Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°)** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **context-agent** | **10.1.0.19** | â€” | **Context Agent (Ğ³ĞµĞ¾Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ, Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ°, ĞºÑƒĞ»ÑŒÑ‚ÑƒÑ€Ğ°, ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ)** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **persona-agent** | **10.1.0.21** | â€” | **Persona Agent (Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€, Ñ‚Ğ¾Ğ½, ÑÑ‚Ğ¸Ğ»ÑŒ, Ğ³Ğ¾Ğ»Ğ¾Ñ, Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€, relationship stage)** | **CPX11 (40GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| Production DB | 10.1.1.2 | â€” | PostgreSQL prod + routing_table + tombstone_registry | AX41 (dedicated) | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| **staging-db** | **10.1.1.3** | â€” | **PostgreSQL staging** | **CPX21 (80GB)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| GitLab | â€” | gitlab-real.unde.life | Git Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ | â€” | âœ… Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |

### Hetzner Helsinki (replicas + etcd + analytics)

| Ğ¡ĞµÑ€Ğ²ĞµÑ€ | IP | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¢Ğ¸Ğ¿ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|--------|----|--------|-----|--------|
| **shard-replica-0** | **10.1.1.10** | **Hot standby replica ÑˆĞ°Ñ€Ğ´Ğ° 0 (Patroni + streaming replication)** | **AX102 (128 GB RAM, 2Ã—2TB NVMe)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **etcd-3** | **10.1.1.20** | **etcd quorum node (3-Ğ¹ ÑƒĞ·ĞµĞ» Ğ´Ğ»Ñ Patroni)** | **CPX11 (~â‚¬4/Ğ¼ĞµÑ)** | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |
| **analytics-replica** | â€” | **ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°, B2B Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹, ML, Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· (Ğ¤Ğ°Ğ·Ğ° 2+)** | **AX162-R (256GB DDR5, $245/Ğ¼ĞµÑ)** | ğŸ“‹ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ |

### Dubai (primary user data + dialogue hot path â€” bare metal / colocation)

**ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** Ğ’ÑÑ‘, Ñ‡Ñ‚Ğ¾ Ğ½Ğ° critical path Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° (ÑĞ·ĞµÑ€ Ğ¶Ğ´Ñ‘Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°), Ğ¶Ğ¸Ğ²Ñ‘Ñ‚ Ğ² Ğ”ÑƒĞ±Ğ°Ğµ.
RTT Dubai â†” Hetzner = 120ms. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ hop = +120ms Ğº latency. Orchestrator Ğ´ĞµĞ»Ğ°ĞµÑ‚ 4-5 hops Ğº ÑˆĞ°Ñ€Ğ´Ñƒ Ğ·Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ = **+480-600ms Ñ‡Ğ¸ÑÑ‚Ğ¾ Ğ½Ğ° ÑĞµÑ‚ÑŒ**. ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ hot path ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² Ğ² Ğ”ÑƒĞ±Ğ°Ğ¹ ÑƒĞ±Ğ¸Ñ€Ğ°ĞµÑ‚ ÑÑ‚Ğ¾ Ğ´Ğ¾ <5ms.

| Ğ¡ĞµÑ€Ğ²ĞµÑ€ | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¢Ğ¸Ğ¿ | Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ |
|--------|--------|-----|--------|
| **dubai-shard-0** | Primary DB: Chat History + User Knowledge. Tmpfs 140 GB, WAL Ğ½Ğ° NVMe | Bare metal dedicated (256 GB RAM, 2Ã— EPYC, 2Ã— 2TB NVMe) | ğŸ†• ĞÑ€ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
| **dubai-app** | App Server (API entry point). Ğ®Ğ·ĞµÑ€Ñ‹ Ğ² Ğ”ÑƒĞ±Ğ°Ğµ â†’ <1ms Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 120ms | Bare metal Ğ¸Ğ»Ğ¸ VPS (8 vCPU, 16 GB) | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-orchestrator** | LLM Orchestrator (dialogue brain). Ğ¥Ğ¾Ğ´Ğ¸Ñ‚ Ğ² shard 4-5 Ñ€Ğ°Ğ·/Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ | Bare metal Ğ¸Ğ»Ğ¸ VPS (4 vCPU, 8 GB) Ã— N pods | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-redis** | Redis (Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸, rate limit, mood/context cache, debounce) | VPS (4 GB RAM) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ½Ğ° app | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-mood** | Mood Agent (ÑĞ¼Ğ¾Ñ†. Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·). ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ path, Orch Ğ¶Ğ´Ñ‘Ñ‚ 300ms | VPS (2 vCPU, 2 GB) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-persona** | Persona Agent (Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€, Ñ‚Ğ¾Ğ½). Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ stage Ğ¸Ğ· shard | VPS (2 vCPU, 4 GB) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-context** | Context Agent (Ğ³ĞµĞ¾Ğ»Ğ¾Ğº, Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ°, ĞºÑƒĞ»ÑŒÑ‚ÑƒÑ€Ğ°) | VPS (2 vCPU, 4 GB) Ğ¸Ğ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **dubai-voice** | Voice Server (TTS proxy â†’ ElevenLabs). Streaming audio ÑĞ·ĞµÑ€Ñƒ | VPS (3 vCPU, 4 GB) | ğŸ†• Ğ¤Ğ°Ğ·Ğ° 2 |
| **etcd-1** | etcd node Ğ´Ğ»Ñ Patroni | Lightweight ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ | ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ |

**Ğ’Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ Ğ¿Ğ¾ latency:**
```
Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ (hot path Ñ‡ĞµÑ€ĞµĞ· Hetzner):    ~480-600ms ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ overhead
ĞŸĞ¾ÑĞ»Ğµ (hot path Ğ² Dubai):            ~5ms ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ overhead
Ğ’Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ:                             ~500ms Ğ½Ğ° ĞšĞĞ–Ğ”Ğ«Ğ™ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
```

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Dubai:**
- **Ğ¤Ğ°Ğ·Ğ° 1 (MVP):** Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ dubai-shard-0 + etcd-1 Ğ² Ğ”ÑƒĞ±Ğ°Ğµ. ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ² Hetzner (Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ½Ğ¾ +500ms).
- **Ğ¤Ğ°Ğ·Ğ° 2 (10K+):** ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ hot path (app + orchestrator + agents + redis + voice) Ğ² Ğ”ÑƒĞ±Ğ°Ğ¹. ĞĞ´Ğ¸Ğ½ bare metal ÑĞµÑ€Ğ²ĞµÑ€ (64 GB RAM) Ğ²Ğ¼ĞµÑ‰Ğ°ĞµÑ‚ Ğ²ÑĞµ ÑÑ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ â€” Ğ¾Ğ½Ğ¸ Ğ»Ñ‘Ğ³ĞºĞ¸Ğµ (ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ½Ğ¾ ~30 GB RAM, 20 vCPU).
- **Ğ¤Ğ°Ğ·Ğ° 3 (50K+):** Kubernetes cluster Ğ² Ğ”ÑƒĞ±Ğ°Ğµ (2-3 bare metal node), Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ pods Ğ´Ğ»Ñ Orchestrator (auto-scale).

**Ğ§Ñ‚Ğ¾ ĞĞ¡Ğ¢ĞĞĞ¢Ğ¡Ğ¯ Ğ² Hetzner Helsinki:**
- Production DB (ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³) â€” batch sync, Ğ½Ğµ Ğ½Ğ° critical path
- Shard Replicas â€” hot standby Ğ´Ğ»Ñ failover
- Recognition pipeline (Ximilar GW, LLM Reranker) â€” async, 5-15s
- Batch pipeline (Scraper, Photo Downloader, Collage, Ximilar Sync)
- Model Generator, TryOn Service â€” async
- Object Storage (images)
- etcd-2, etcd-3 (Patroni quorum)

> **ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:** Ğ’ÑĞµ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ Ğ½Ğ° critical path (App, Orchestrator, Agents, Redis, Voice) Ğ¿Ğ¾Ğ¼ĞµÑ‰Ğ°ÑÑ‚ÑÑ Ğ½Ğ° **Ğ¾Ğ´Ğ½Ğ¾Ğ¼** bare metal ÑĞµÑ€Ğ²ĞµÑ€Ğµ (64 GB RAM, 16 cores) Ğ² Ğ”ÑƒĞ±Ğ°Ğµ ĞºĞ°Ğº Docker Compose Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°Ğ¼Ğ¸. Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: ~$300-400/Ğ¼ĞµÑ. Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°Ğ½Ğ¾: 500ms ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ğ¸ Ã— Ñ‚Ñ‹ÑÑÑ‡Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ğ´ĞµĞ½ÑŒ = Ğ¾Ñ‰ÑƒÑ‚Ğ¸Ğ¼Ğ¾ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ UX.

---

---

## ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼

| Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ |
|------|-----------|
| **â†’ Ğ’Ñ‹ Ğ·Ğ´ĞµÑÑŒ** | ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹, Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°, ĞºĞ°Ñ€Ñ‚Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² |
| [01_Catalog_Pipeline.md](01_Catalog_Pipeline.md) | Scraper, Apify, Photo Downloader, Ximilar Sync, Collage, Staging DB, Object Storage |
| [02_Recognition_Pipeline.md](02_Recognition_Pipeline.md) | Recognition Orchestrator, Ximilar Gateway, LLM Reranker |
| [03_Dialogue_Pipeline.md](03_Dialogue_Pipeline.md) | Mood Agent, Voice Server, LLM Orchestrator, Context Agent, Persona Agent |
| [04_Dubai_User_Data_Shard.md](04_Dubai_User_Data_Shard.md) | Dubai Shard: ÑÑ…ĞµĞ¼Ğ° Ğ‘Ğ”, Ñ€ĞµĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ, ÑˆĞ°Ñ€Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ±ÑĞºĞ°Ğ¿Ñ‹ |
| [05_Data_Flow.md](05_Data_Flow.md) | Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (7 ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ²) |
| [06_Operations.md](06_Operations.md) | Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ, Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³, Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ |
| [UNDE_Knowledge_Staging_Pipeline.md](../UNDE_Knowledge_Staging_Pipeline.md) | Epistemic Contract, pipeline Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹, instant/batch extraction, supersede, correction loop, privacy guard, enrichment TTL |
